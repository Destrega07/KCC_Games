## 可行性说明

* 完全支持：通过响应式布局和条件渲染，使手机端与电脑端呈现不同 UI。实现方式包括：

  * CSS 媒体查询与栅格调整（\<md 为移动端、≥md 为桌面端）。

  * 画布尺寸与排版在 `resizeCanvas()` 中根据视口宽高动态计算。

  * 可选按需隐藏/折叠面板（移动端采用页签/抽屉，桌面端采用并排三栏）。

## 改造目标

* a. 手机端 UI：主大坝画面优先展示，工具/面板通过页签折叠，保证可用面积；

* b. 电脑端 UI：改为附图3布局（分成左中右布局。左三分之二区域分成2x3矩形网格：第一行的两格放概念图和信息区，第二、第三行的四格放四区大坝；中间是一条很窄的水位尺；右面剩下区域是：工具箱/波形/摘要/推理记录）

* c. 尝试次数限制：总共 3 次并在 UI 中显示，达到上限后禁止继续点击并提示。

## 详细方案

### 手机端布局（< md）

* 主区域改为纵向：

  * 顶部状态栏保留（倒计时 + 尝试次数 + 重置）。

  * 主大坝画布占屏幕宽度与 48–60vh 高度（确保“中间的大坝区域”总能显示）。

  * 工具箱改为底部固定页签：声波 | 热成像 | 档案；点击切换上方信息卡与波形/摘要。

  * 推理记录折叠为“历史记录”卡片，点击展开。

* 技术实现：

  * `main` 从 `flex` 改为在移动端使用 `flex-col`，左/右侧 `aside` 在移动端隐藏或移动到底部容器。

  * `#mainCanvas` 增加最小高度样式与 `resizeCanvas()` 内的移动端高度策略：`height = Math.max(420, window.innerHeight * 0.55)`。

### 电脑端布局（≥ md，附图3样式）

* 三栏栅格：

  * 左栏（占屏幕面积的2/3）：概念图缩略 + 信息区（背景/任务/提示）+ 四区大坝（居中，带分割线与区字母）。

  * 中栏（极窄）：水位尺。

  * 右栏：工具箱（按钮行）+ 声波频谱 + 区域摘要 + 推理记录。

* 保留现有视觉风格，调整间距与标题位置，确保横向信息密度与附图3一致。

### 水位标尺修正（右沿 0–30m）

* 要求：D 区右下角显示 0、B 区右上角显示 30，从 D 右下到 B 右上的直线分成六等分（每 5m）。

* 实现：

  * 以右沿垂直边为标尺线：`x = w - padding`，`yTop = waterH`（桌面 0）、`yBottom = waterH + damH`。

  * `for m in 0..6`: 位置 `y = yBottom - m * damH/6`，刻度短线 ±6px；`m*5` 文本在刻度左侧对齐。

  * 文本“30m/0m”分别绘制在顶/底；中间标注 `5/10/15/20/25`。

* 代码落点：`drawRulers()`（当前在 3.水坝决堤.html:701 附近）。

### 裂纹与交互保留

* 保持折线裂纹与悬停命中提示逻辑：`minDistanceToPolyline()` 与 `handleCanvasHover()`（约 3.水坝决堤.html:784）。

### 尝试次数限制（总 3 次）

* 状态新增：`maxAttempts = 3`，`attemptsLeft = 3`。

* UI：

  * 顶部状态栏增加“尝试次数”模块，样式与倒计时一致，显示 `3/3`、`2/3`…

* 逻辑：

  * 在 `handleCanvasClick()`（约 3.水坝决堤.html:740）中，先判断 `attemptsLeft > 0` 才允许点击；每次点击后 `attemptsLeft--` 并更新 UI。

  * 当 `attemptsLeft === 0`，禁止点击，显示提示“尝试次数已用尽，请重置任务或查看工具线索”。

  * `restartGame()`（约 3.水坝决堤.html:400）重置为 3 次并清空推理记录。

## 实施步骤（按文件内函数位置）

1. 布局与样式

* 在主模板上为 `main/aside/section` 添加响应式类：移动端 `flex-col`、隐藏右栏，底部增加工具页签容器。

* `resizeCanvas()`（3.水坝决堤.html:391）根据断点设置画布高度。

1. 电脑端 UI 样式对齐附图3

* 左信息区与右工具区宽度固定，中心画布自适应；标题居中。

1. 标尺修正

* 完善 `drawRulers(w, waterH, damH)` 的刻度与文本布局，使 0–30m 等分准确。

1. 尝试次数

* 在状态与头部 UI 中加入尝试次数；更新 `handleCanvasClick()` 与 `restartGame()`。

## 验证

* 移动端：竖屏下主画布始终显示，工具切换顺畅；尝试次数与提示正确更新。

* 桌面端：排版符合附图3；右沿标尺显示为 0,5,10,15,20,25,30；点击次数达到 3 后锁定。

如确认以上方案，我将开始
