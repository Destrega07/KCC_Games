## 升级目标
- 从“单次点选”升级为“基于三种工具的模糊线索推理 + 点击验证”的玩法（文档 0/1/2/3 节）。
- 统一桌面与移动端体验，采用多栏布局与响应式（文档 1/2 节）。
- 将胜利条件绑定线索使用度：至少 2 种工具，最佳为 3 种；保留当前决堤动画与结算（3.水坝决堤.html 现有：喷涌/崩塌/灌溉与胜利弹窗）。

## 现状与可复用
- 现有基础场景、裂纹与胜利流程完整：
  - 生成薄弱点与假裂纹：3.水坝决堤.html:295-313
  - 场景绘制（水面/大坝/农田）：3.水坝决堤.html:315-401
  - 点击判定与决堤动画：3.水坝决堤.html:466-589、591-675
  - 计时与提示、胜负弹窗：3.水坝决堤.html:737-783、678-698、772-782
- 不足：无多模式与工具栏、右侧信息面板；线索全部隐藏在美术层，没有推理链与解锁时序。

## 新架构设计
- 布局
  - 顶部状态栏：倒计时、情报收集度（3 个圆点）、标题、重置按钮（文档 1.1）。
  - 中部三列：左侧工具栏（声波/热成像/档案）、中间主 Canvas、右侧信息面板（频谱与分区摘要）（文档 2）。
  - 底部提示条：动态提示文本（文档 2 与 4）。
- 状态机
  - `state.activeMode = 'normal' | 'sound' | 'thermal' | 'archive'`。
  - `state.intel = { sound:false, thermal:false, archive:false }`；首次有效使用置 true 并点亮顶部圆点。
  - 工具解锁时间门槛：热成像 30s、档案 60s（文档 2.1.1）。
  - 胜利判定需：命中薄弱点且 `intelCount >= 2`（文档 5）。若不足则给“幸运爆破手”提示（文档 5）。
- 数据与渲染层
  - `generateWeakPoint` 与 `generateFakeCracks` 保留并扩展裂纹数据结构（文档 2.2.1 推荐字段）。
  - 渲染管线：
    - 基础场景：水面/大坝/农田。
    - normal/sound：正常混凝土 + 裂纹；sound 模式在右侧显示频谱，并让裂纹轻微抖动。
    - thermal：伪彩色热图，C 区整体偏冷；在 C 区内绘制模糊的浅蓝“大片冷区”（不单点）。
    - archive：右侧或悬浮窗展示档案内容（语义线索，不出现坐标）；与当前画布叠加。
  - 右侧面板：独立小 Canvas 绘制 4 段波形，对应 A/B/C/D（文档 2.3.1）；下面分区状态摘要使用模糊语言（文档 2.3.2）。
- 交互与命中逻辑
  - 仅当点击在大坝区域（y∈[150,400]）才判定（现有 3.水坝决堤.html:479-482）。
  - 以“近邻半径”判断是否命中某条裂纹中心（保留现有弱点判定并对裂纹集合统一判定）。
  - 若已满足线索使用度且命中真弱点 → 决堤动画（复用触发链：crack → sprayWater → collapseDam → irrigateFarm）。

## 技术细节与实现要点
- 组件化：将渲染函数拆分为 `drawBaseScene`, `drawCracks`, `renderSoundOverlay`, `renderThermalOverlay`, `renderArchivePanel`。
- 工具栏按钮：时间未到前禁用并显示锁；到时自动解锁并提示（文档 2.1.1）。
- 频谱：用 `requestAnimationFrame` 或 `setInterval` 绘制简易波形；C 区振幅略高，D 次之（文档 2.3.1）。
- 坐标与移动端：用 `devicePixelRatio` 与 `rect` 比例映射，避免触控偏移（参考此前在 1.九星迷阵 的修复方案）。
- 性能：热成像伪彩可用预生成渐变 + 蒙版叠加，不做逐像素着色；裂纹轻微抖动仅在 sound 模式。
- 文案：底部提示按模式刷新，遵守“模糊线索”原则（文档 4）。

## 开发步骤
1. 重构页面骨架：顶部状态栏 + 左工具栏 + 中主 Canvas + 右信息面板 + 底部提示。
2. 状态与解锁：计时器回调中 30s/60s 解锁工具；首次使用置 `intel` 点亮圆点。
3. 渲染分层：抽象渲染函数并整合到主 `drawScene()`；依据 `activeMode` 叠加 overlay。
4. 频谱与摘要：右侧波形动画与分区摘要文案。
5. 档案浮窗：语义记录，强调 C 区中下部靠左与地标描述（不出现坐标）。
6. 点击判定：命中真弱点且 `intelCount>=2` 才播胜利链；否则提示“建议先使用工具”。
7. 保留并增强动画链：裂纹扩展/水喷涌/崩塌/灌溉；结算弹窗沿用并丰富文案。
8. 自测与移动端适配：触控坐标、按钮点击区、响应式布局。

## 重构策略
- 采用“就地重构”：保留 `generateWeakPoint`/`generateFakeCracks`、动画链与弹窗实现。
- 若在实现中出现耦合阻碍，允许清空 `3.水坝决堤.html` 并按新架构从头实现，保证代码整洁与可维护。

## 交付
- 完整的 `3.水坝决堤.html` 重构版本，含多模式工具栏、右侧信息面板、热成像与档案逻辑、胜利条件绑定线索使用度。
- 移动端与桌面端一致体验；无需后端即可部署（与现有 index.html 集成方式不变）。