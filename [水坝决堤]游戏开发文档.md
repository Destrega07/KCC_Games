# 「水坝决堤：战略侦探版」游戏开发文档

版本：设计文档 v2  
目标读者：AI Coding Agent / 前端工程师  
技术栈预期：HTML + CSS (Tailwind 可选) + 原生 JavaScript + `<canvas>`  

---

## 0. 游戏核心概念与目标

### 0.1 世界观与设定

- 上游：水库（大量蓄水）
- 中间：大坝（存在多处裂纹，其中只有一个“战略杠杆点”）
- 下游：干涸农田（急需灌溉）
- 玩家身份：工程“战略侦探”，需要在有限时间内，利用 3 种工具查找大坝最薄弱的一点，使水冲破大坝、灌溉农田。

### 0.2 核心玩法目标

- 在倒计时内，利用三种侦测工具：
  1. **声波监测**（粗略锁定可疑分区）
  2. **热成像**（锁定分区内的低温区域）
  3. **历史档案**（通过“特征描述”和“地标”进一步缩小到某一位置附近）
- 通过多步推理后，在**正常视图**下点击一条具体裂纹：
  - 击中真正“薄弱裂纹”且使用了足够情报 → 胜利（决堤动画 + 培训总结）
  - 时间耗尽或点击错误过多 → 失败（给出线索复盘）

> 关键要求：  
> 工具**只提供模糊线索**，不直接给出“某区异常”“具体坐标”，玩家必须整合多源信息完成推理。

---

## 1. 界面总结构（UI 总览）

整体布局建议采用三列结构：

- **顶部：全局状态栏**
- **中部：左侧工具栏 + 中间主视窗(Canvas) + 右侧信息面板**
- **底部：提示文本栏**

### 1.1 顶部状态栏

| 区块             | 内容                              | 行为 / 说明                         |
|------------------|-----------------------------------|-------------------------------------|
| 左侧：倒计时面板 | 剩余时间（秒）+ 图标              | 每秒更新；时间到则游戏失败          |
| 左侧：情报收集度 | 3 个小圆点：声波 / 热成像 / 档案 | 对应工具首次有效使用即点亮          |
| 中央：标题       | “水坝决堤 - 战略侦探版”          | 静态文本                            |
| 右侧：按钮       | “重置任务” / “开始任务”（可选）  | 调用 `restartGame()` 重置游戏状态   |

**视觉建议：**

- 背景：深蓝/深灰 (`#0f172a` 级别)
- 文本：白色 + 蓝色高亮
- 圆点状态：
  - 灰色：未收集
  - 绿色/蓝色/橙色：已收集对应情报

---

## 2. 中部主区域结构

### 2.1 左侧工具栏（Tool Bar）

竖直排列 3 个按钮（桌面端），移动端可考虑横排。

#### 2.1.1 工具按钮一览

1. **声波监测 (默认解锁)**
   - 图标：波形图 / 心电图样
   - 状态：
     - 可用（默认激活）
   - 悬浮提示：  
     > 声波监测：分析大坝各分区的震动模式（初步锁定可疑分区）

2. **热成像（30 秒后解锁）**
   - 图标：温度计 / 火焰
   - 初始状态：灰色、禁用，带小锁
   - 到达 30s 自动解锁（按钮变亮 + 提示）
   - 悬浮提示（解锁前）：  
     > 热成像：未解锁（30 秒后可用）  
     悬浮提示（解锁后）：  
     > 热成像：查看大坝表面温度，寻找异常低温区

3. **历史档案（60 秒后解锁）**
   - 图标：文档 / 文件
   - 初始状态：灰色、禁用，带小锁
   - 到达 60s 自动解锁
   - 悬浮提示（解锁前）：  
     > 机密档案：未解锁（60 秒后可用）  
     悬浮提示（解锁后）：  
     > 机密档案：查看历史维修记录与工程图片段

#### 2.1.2 工具按钮交互规则

- 点击某个工具：
  - 设置 `state.activeMode = 'sound' | 'thermal' | 'archive' | 'normal'`
  - 更新按钮样式（激活态高亮，其他取消）
  - 触发不同的 Canvas 渲染模式／覆盖层（见 3. 部分）
- 历史档案属于**模式 + 浮窗**：
  - 点击后在主视窗上方打开档案浮窗（可关闭）
  - `state.activeMode` 仍保留当前画布模式（多为 normal 或 sound）

---

### 2.2 中间：主视窗（Main Viewport）

主视窗核心由一个 `<canvas>` 承载，大多数渲染在其上。

建议分为两个层次：

1. **全局世界观缩略图 / 顶层背景（可选）**
   - 上部区域：
     - 左上：水库水面（蓝色渐变）
     - 中：大坝弧面或平面主体
     - 右下：干涸农田 + 小灌渠
   - 用于一眼让玩家明白：水 → 大坝 → 农田 的因果关系  
   - 这部分可以是一个单独的小 Canvas 或静态图片嵌入右上角/左上角。

2. **大坝分区结构图主 Canvas（主要交互区）**
   - 区域分布（占视窗大部分中下区域）：
     - 上方：水面（占高度约 25–30%）
     - 中下：大坝正面矩形（占高度约 60–65%）
     - 下边界外：农田区域部分可见（可以出现在决堤动画阶段）

#### 2.2.1 大坝分区结构（核心玩法区）

大坝区域被划分为四个大分区：

- A 区：左上坝段
- B 区：右上坝段
- C 区：左下坝段
- D 区：右下坝段

**显示元素：**

1. **分区网格**
   - 使用水平 + 垂直线，将大坝矩形区域分成 2x2。
   - 每格中央用大号淡色字母标记：A / B / C / D。
   - 左下角额外文本：`大坝分区结构图` （小号）

2. **裂纹（Cracks）**
   - 数据结构建议：

     ```js  
     {  
       x: number,  
       y: number,  
       length: number,  
       angle: number,  
       width: number,  
       isReal: boolean // 只有一条为 true  
     }  

     - 表现：
        颜色：深灰接近黑色 (#111827 ~ #1e293b)
        形态：锯齿/折线 + 可能带 1–2 条小分支，而非简单直线
        轻微抖动动画（可选：在声波模式下抖动更明显）
    -悬浮时（可选增强）：
        底部提示文案：
        “微小裂纹：肉眼无法判断其危险程度”

3. **可点击区域逻辑**
    - 玩家点击 Canvas 内、且 y > 水面高度 才会判定。
    - 检查点击点与每条裂纹中心点距离：
        若落在某条裂纹的近邻区域，视为点击该裂纹；
        若点击空白区域，可以给出“此处结构完整”的反馈。

### 2.3 右侧信息面板（Info Panel）
右侧竖直排列两个小模块：
- 顶部：声波频谱图
- 底部：分区状态摘要

#### 2.3.1 声波频谱图（Wave Panel）
- 使用独立 <canvas>。
- 横轴划分为四段：A/B/C/D。
- 每段显示一条动态波形线。

关键逻辑（不直接给答案）：
- A 区、B 区：
    绿色波形
    振幅与频率均在“正常范围”
- C 区、D 区：
    均为红色或橙红色波形，表示“有异常趋势”
    C 区波形设计为：频率稍低、振幅更大、波形更有“共振感”
- D 区：振幅略高于正常，但不如 C 区明显。

目的：
玩家通过对比四条波形曲线，自己得出结论：
“C 区的振动最异常，其次是 D。”

不允许出现的内容：
不在任何文字或标签中写“C 区 异常”“问题在 C 区”这类明确结论。

#### 2.3.2 区域状态摘要（Zone Status）
- 分 4 个小卡片：A 区、B 区、C 区、D 区。
- 每张卡片只显示 模糊描述：
    示例文案（声波模式下，动态更新文本）：
    A：波动正常
    B：波动正常
    C：波动偏强
    D：轻微异常
-颜色：
    正常：灰色文字 text-slate-500
    偏强 / 轻微异常：橙色或淡红色文字，但不高亮到一眼就是答案。

## 3. 三种模式的画面与逻辑
### 3.1 声波模式（Sound Mode）
state.activeMode = 'sound'
- 画面组成：
    上方水面保持轻微水波动画
    大坝分区图以正常颜色显示（裂纹可轻微抖动，表示受到震动）
    右侧频谱动画积极更新
- 提示文案（底部）示例：
    初次进入：“声波监测模式。观察右侧频谱，寻找波形异常的分区（这是第一层线索，不是最终答案）。”
    保持 2–3 秒后自动淡出或被后续提示覆盖。    
- 声波模式目标：将范围从四个区 → 收窄为「以 C 区为主，D 区为次」。

#### 3.2 热成像模式（Thermal Mode）
- 解锁条件：游戏进行时间 ≥ 30 秒。
state.activeMode = 'thermal'
- 画面变换：
    大坝区域不再显示灰色混凝土，而是热成像伪彩色：
        整体背景：黄色/橙色（正常温度）
        随机 3–5 处红色热点（无关干扰）
        C 区整体略偏冷色（但不至于“一块蓝膏药”）
        在 C 区内，绘制一块较大但模糊的浅蓝区域，覆盖多条裂纹所在范围
- 关键点：不显示单一小蓝点作为答案，而是“冷区大片”，玩家只知道“冷区大致范围”。

- 底部提示文案示例：
    初次切换：“热成像模式已启动。留意温度略低的区域（冷色区域），它们可能代表内部空隙或临时修补材料。”
    合适时追加：“注意：热成像只能锁定大致区域，仍无法判断哪一条裂纹最危险。”

- 热成像模式目标：把范围从“整块 C 区”→“C 区内某一片冷区”。

### 3.3 历史档案模式（Archive Mode）
- 解锁条件：时间 ≥ 60 秒。
- 点击工具按钮打开一个悬浮档案窗（不一定要切换 Canvas 模式，可以叠加在 normal/sound 上）。

#### 3.3.1 历史档案内容结构
档案为一张“纸”，包含 3 条以上的修补记录，分别指向不同区域，制造迷惑性。

示例结构：

    绝密档案 #804  

    日期：1987年11月12日  
    工程队：第七加固组  

    维修记录节选：  

    1）1983年 - A区  
    描述：在溢洪道上方右侧安装了矩形钢板进行加固。  

    2）1985年 - D区  
    描述：在大坝底部靠右位置修补了排水孔周围的石块。  

    3）1987年 - C区（关键线索）  
    描述：施工队在“主排水口左下方约5米处”的接缝位置，  
            使用了“三角形钢板补丁”进行临时加固。  
            记录备注：材料供应不足，仅采用临时方案，建议后续复查。  

    4）1992年 - B区  
    描述：例行表面防水层翻新，无结构性问题记录。  

设计要点：
    1.至少 3 条记录，其中只有一条是真正指向薄弱区域（例如 C 区）。
    2.每条记录用地标+形状描述，不允许出现像素/坐标数字。


地标示例：
    “主排水口”
    “溢洪道”
    “检修平台”

形状/相对位置示例：
    “从主排水口往左，大约一个检修平台的距离”
    “位于溢洪道下方略偏左的位置”
    “在检修平台正下方、坝体中部偏下位置”
    “靠近左侧山体一侧的中腰位置”

具体记录示例（3 条里只有 1 条是真的）：
- 记录 A（真线索）
    “巡检记录显示：C 区中下部靠左、紧邻检修平台的位置，曾因施工期赶工，仅采用临时填充材料处理微裂缝。”

- 记录 B（干扰线索）
    “B 区上缘靠近溢洪道一带，曾发现表层油漆老化，但未发现结构性问题。”

- 记录 C（模糊但不致命的次要问题）
    “D 区下缘靠近山体一侧，过往有轻微渗水记录，已使用高标号混凝土回填，后续监测数据正常。”

这样玩家阅读完档案后，得到信息是：

真正值得高度警惕的是：
“C 区中下部靠左、靠近检修平台”的那一块。
其他提到的问题（B 区油漆、D 区渗水）不会直接指向结构薄弱，只是噪音。

## 三步线索如何在玩家脑中形成推理链
把三个工具串成一个清晰的思考路径：

- 声波监测（范围收缩到 2 区）
    玩家观察频谱后得到：
    A/B：波形平稳 → 暂时排除。
    C/D：波形总体更活跃，C 略大于 D。
    玩家结论：“问题更可能在 C 或 D 中，C 区风险更高。”

- 热成像（在高风险区内画出一块“疑似区域”）
    切换热成像后：
    C 区整体比 D 稍冷。
    C 区中下部靠左这一片，颜色比周围更蓝一些。
    玩家结论：“如果真的有空隙，那么最可疑的是 C 区中下部靠左这一片。”

- 历史档案（用语义 + 地标验证这片区域）
    阅读档案后，发现：
    唯一一个关于“结构修补且材料较差”的记录，就出现在
    “C 区中下部靠左、紧邻检修平台”的位置。
    这恰好与热成像的冷区位置重合。
    
玩家最终推理：
    “声波= C/D 异常，C 更明显；
    热成像= C 区中下部靠左更冷；
    档案= C 区中下部靠左曾用临时材料修补；
    三条线索重合 → 真正薄弱点就在这片区域内的一条裂缝上。”

点击行动（在区域内多条裂纹中做出选择）

回到正常视图：
在 C 区中下部靠左这一片，布满多条裂缝（形状/长度不同，但没有“明显标记”）。
玩家要么：
根据主观判断，选择“贯穿更深、连接更长”的那一条；
要么允许 1–2 次局部试错，在这片区域内探索。
命中真正那条裂缝 → 触发水坝决堤动画与结局说明。

## 四、UI 信息呈现上的具体优化建议（概括）
为了让玩家“看得懂、玩得明白，又有推理空间”，可以在 UI 层这样安排：

顶部/左上：世界观总览小图

简化版水坝场景图（上游水库 + 中间大坝 + 下游农田）。
旁边一行简短说明：
“任务：在水位上涨前，通过三种侦测手段，找出大坝最薄弱的一点，释放水流灌溉农田。”

中央主画面：大坝四分区 + 裂纹

清晰标出“A/B/C/D 区”，并加小标签“上坝段/下坝段/左/右”。
裂纹画成锯齿/分叉形，并在首次进入时弹出说明：
“提示：每一条黑色锯齿线代表一处肉眼可见的裂纹，但危险程度难以凭肉眼判断。”

右侧面板：工具反馈信息用“模糊语言 + 量感描述”

声波面板：只用“正常 / 波动偏强 / 轻微异常”等字眼，不出现“C 区异常”这种绝对判语。
热成像面板：如果有辅助图，只显示“低温区大致在哪块”，而不是打点。
档案面板：用自然语言描述位置，不出现坐标和“精准锁定”。
底部消息条：引导推理路径而不是告诉答案

声波阶段：
“声波数据显示：某些区域的震动频率明显不同…… 试着比较 A/B/C/D 的波形差异。”

热成像阶段：
“注意：热成像中，同一分区内部的温差往往意味着结构空隙。”

档案阶段：
“历史记录不会告诉你确切答案，但可以帮助你验证前面两个线索的推断是否正确。”

## 五、难度与体验平衡建议
最低通关路径：
至少阅读/使用 2 种工具（例如声波 + 热成像，或热成像 + 档案）才能较高概率找准区域；
使用 3 种工具则明显更有把握。

“瞎蒙成功”的情况：
可以不禁止，但结算时提示：
“你这次更像是幸运的爆破手，而不是冷静的策略家。
建议尝试一局：先用完三种工具，再决定下手地点。”

这样既保留了游戏性，也强化了培训的“方法论”目标。